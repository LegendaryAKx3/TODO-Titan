{% extends "layout.html" %}

{% block title %}
Home
{% endblock %}

{% block body %}
<div id="todo-index">
    <h1>TODO Titan</h1>
    <br>
    <h3>Main</h3>
    <ul id="todo-list">
        {% for task in tasks %}
        {% if task.section_id == None %}
        <div id="todo-itm">
            <form action="/delete" method="post">
                <input type="hidden" name="id" value="{{ task.task_id }}">
                <button type="submit" id="delete">Done</button>
            </form>
            <p>{{ task.task_text }}</p>
            <form action="/move-between-section" method="post">
                <input type="hidden" name="task-id" value="{{ task.task_id }}">
                <!-- <h5>Move To:</h5> -->
                <select name="to-section">
                    <option selected value>Main</option>
                    {% for section in sections %}
                    <option value="{{ section.section_id}}">{{ section.section_name }}</option>
                    {% endfor %}
                </select>
                <button type="submit">Move</button>
            </form>
        </div>
        {% endif %}
        {% endfor %}
    </ul>
</div>

<!--
<ul>
    <li class="">An item</li>
</ul>
-->

<div class="sections">
    {% for section in sections %}
    <h3>{{ section.section_name }}</h3>
    <form method="post" action="/section-delete">
        <input type="hidden" name="section-id" value="{{ section.section_id }}">
        <button type="submit">Delete Section</button>
    </form>
    <form method="post" action="/section-delete-all">
        <input type="hidden" name="section-id" value="{{ section.section_id }}">
        <button type="submit">Delete Section and Tasks</button>
    </form>
    <ul id="todo-list">
        {% for task in tasks %}
        {% if task.section_id == section.section_id %}
        <p>{{ task.task_text }}</p>
        <form action="/delete" method="post">
            <input type="hidden" name="id" value="{{ task.task_id }}">
            <button type="submit" id="delete">Done</button>
        </form>
        <form action="/move-between-section" method="post">
            <input type="hidden" name="task-id" value="{{ task.task_id }}">
            <h5>Move To:</h5>
            <select name="to-section">
                <option selected value>Main</option>
                {% for section in sections %}
                <option value="{{ section.section_id}}">{{ section.section_name }}</option>
                {% endfor %}
            </select>
            <button type="submit">Move</button>
        </form>
        {% endif %}
        {% endfor %}
    </ul>
    {% endfor %}
</div>
<!--POPUP-->
<button class="open-button" role="button" onclick="openForm()">Add Task</button>

<div class="form-popup" id="myForm">
    <form action="/" class="form-container" method="post">
        <h1>Add Task</h1>

        <label for="create-task"><b>Task</b></label>
        <input type="text" placeholder="Enter a Task" name="task" required autocomplete="off">

        <select name="section">
            <option selected value>Main</option>
            {% for section in sections %}
            <option value="{{ section.section_id }}">{{ section.section_name }}</option>
            {% endfor %}
        </select>

        <button type="submit" class="btn">Add Task</button>
        <button type="button" class="btn cancel" onclick="closeForm()">Close</button>
    </form>
</div>
<script>
    function openForm() {
        document.getElementById("myForm").style.display = "block";
    }

    function closeForm() {
        document.getElementById("myForm").style.display = "none";
    }
</script>

<div id="add-section">
    <h4>Add Section</h4>
    <form action="/section-create" method="post">
        <input autocomplete="off" name="section" placeholder="Section Name">
        <button type="submit">Create</button>
    </form>
</div>
{% endblock %}